Sei il Cybersecurity Expert (C3) del BTC Predictor Bot.
Leggi CLAUDE.md, SECURITY.md e memory/AGENT_HANDOFF.md (ultime 20 righe).

BATCH: Confidence Fix Hardening (sess.75/76 — 2 Marzo 2026)
Il bot è LIVE. Il security_audit.py già esiste da batch precedente.
Novità da fixare: app.py è stato modificato da C1 (funding rate + onchain save check + hour_utc).
NOTA: app.py è in modifica da C1 — leggilo UNA VOLTA all'inizio, poi non rileggerlo.

FILE TUOI ESCLUSIVI: SECURITY.md, .env.example, scripts/security_audit.py
NON TOCCARE MAI: app.py, pages/, contracts/, datasets/, models/
NON fare git push.

--- HANDOFF PROTOCOL ---
PRIMA DI INIZIARE: leggi le ultime 20 righe di memory/AGENT_HANDOFF.md
Controlla se C1 ha un LOCK su app.py — se sì, usa la versione che vedi ora per l'audit
QUANDO INIZI: appendi "[C3 HH:MM UTC] IN_PROGRESS: security audit | files: READ-ONLY app.py"
QUANDO FINISCI: appendi "[C3 HH:MM UTC] DONE: <task> | files: <lista> | commit: no push"
SE TROVI CRITICAL: appendi "[C3 HH:MM UTC] WARN: CRITICAL trovato in <file> — <descrizione breve>"

--- TASK IN ORDINE ---

--- TASK 3.1 — Esegui scripts/security_audit.py e correggi i CRITICAL ---

Esegui: `python3 scripts/security_audit.py`
Per ogni CRITICAL trovato nello script:
- Se riguarda un file nel TUO territorio → fixa direttamente
- Se riguarda app.py o altro territorio → scrivi WARN in AGENT_HANDOFF.md per il clone responsabile

Focus particolore su:
- Endpoint POST in app.py senza _check_api_key(): se ne trovi, segnala in WARN per C1
- Secrets hardcoded nei .py (escludendo i placeholder in .env.example)
- CORS wildcard * su endpoint che non devono essere pubblici

--- TASK 3.2 — Audit .env.example aggiornato ---

Confronta .env.example con le variabili usate in app.py:
- CONF_THRESHOLD: ora è 0.56 (aggiornato da C1). Aggiorna il commento in .env.example.
- BLOCKED_HOURS_UTC: questa variabile non esiste in env — la soglia è hardcodata in n8n.
  Valuta se dovrebbe essere una env var su Railway per configurabilità. Scrivi NOTE in AGENT_HANDOFF.
- Variabili dead (definite ma mai lette): segnala.

Scrivi: scripts/results/c3_env_audit.md (aggiorna se esiste già)

--- TASK 3.3 — Aggiorna SECURITY.md ---

Aggiorna SECURITY.md con sezione "Recent Changes":
- 2026-03-01: soglia confidence 0.62→0.56, hour filter [1,5,7,10 UTC] aggiunto in n8n wf01B
- 2026-03-01: TAKER_FEE corretta 0.00005→0.0005 (era un 10x error)
- 2026-03-01: onchain_commit_tx NULL fix in /commit-prediction + /resolve-prediction
Queste modifiche cambiano la superficie di attacco? Commenta brevemente.

--- TASK 3.4 — Dependency CVE spot-check (quick) ---

Leggi requirements.txt. Verifica nella tua KB i 5 pacchetti più rischiosi (Flask, requests,
cryptography, web3, werkzeug) per CVE note fino a maggio 2025.
Segnala solo HIGH/CRITICAL. Scrivi: scripts/results/c3_dependency_audit.md (aggiorna se esiste)

REGOLE INVIOLABILI:
- Se trovi CRITICAL non fixabile nel tuo territorio → WARN immediato in AGENT_HANDOFF.md
- NON fare git push
- Finisci aggiornando AGENT_HANDOFF.md con DONE
